# Настройка OAuth для отображения вашего домена вместо Supabase

## Проблема

При авторизации через Google OAuth пользователи видят сообщение "to continue to ugezbyszafkijwqifqlg.supabase.co" вместо вашего реального домена сайта.

## Почему это происходит?

Google OAuth показывает домен, на который будет редирект после авторизации. Поскольку OAuth callback обрабатывается Supabase, Google видит домен Supabase.

## Решения

### Вариант 1: Использование кастомного домена для Supabase Auth (Платно)

**Требования:** Платный план Supabase (Pro или выше) + Custom Domain Add-on (~$10/месяц)

**Шаги:**
1. Перейдите в Supabase Dashboard → Settings → Custom Domains
2. Добавьте ваш кастомный домен (например, `auth.yourdomain.com`)
3. Настройте DNS записи согласно инструкциям Supabase
4. После настройки Google будет показывать ваш домен вместо `supabase.co`

**Плюсы:**
- Полностью решает проблему
- Профессиональный вид

**Минусы:**
- Требует платного плана (~$25/месяц + $10/месяц за кастомный домен)

### Вариант 2: Настройка правильных Redirect URLs (Бесплатно, но ограничено)

Это не изменит то, что Google показывает в интерфейсе выбора аккаунта, но обеспечит правильный редирект на ваш сайт.

**Шаги:**

1. **В Supabase Dashboard:**
   - Перейдите в Authentication → URL Configuration
   - Установите **Site URL** на ваш реальный домен:
     - `https://ccplearn.pages.dev/` (если используете Cloudflare Pages)
     - или `https://yourusername.github.io/yourrepository/` (если используете GitHub Pages)
   - В **Redirect URLs** добавьте:
     - `https://ccplearn.pages.dev/**` (или ваш GitHub Pages URL)
     - `https://yourusername.github.io/yourrepository/**`
     - `http://localhost:5173/**` (для разработки)

2. **В Google Cloud Console:**
   - Перейдите в [Google Cloud Console](https://console.cloud.google.com/)
   - Выберите ваш проект
   - Перейдите в APIs & Services → Credentials
   - Найдите ваш OAuth 2.0 Client ID
   - В **Authorized redirect URIs** убедитесь, что есть:
     - `https://ugezbyszafkijwqifqlg.supabase.co/auth/v1/callback`
     - (Это обязательно должно быть, так как Supabase обрабатывает callback)

3. **Проверьте код:**
   Убедитесь, что в `services/db.ts` правильно настроен `redirectTo`:

```typescript
signInWithGoogle: async (): Promise<{ error: string | null }> => {
  if (!supabase) {
    return { error: 'Supabase is not configured' };
  }

  try {
    const { error } = await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: `${window.location.origin}${import.meta.env.BASE_URL}`,
        queryParams: {
          access_type: 'offline',
          prompt: 'consent',
        },
      }
    });

    if (error) return { error: error.message };
    return { error: null };
  } catch (error: any) {
    return { error: error.message || 'Google sign-in failed' };
  }
},
```

**Плюсы:**
- Бесплатно
- Правильный редирект на ваш сайт

**Минусы:**
- Google все равно будет показывать домен Supabase в интерфейсе выбора аккаунта
- Это ограничение Google OAuth, которое нельзя обойти на бесплатном плане

### Вариант 3: Использование собственного OAuth flow (Сложно, но бесплатно)

Можно реализовать собственный OAuth flow без Supabase, но это требует:
- Собственного backend сервера
- Хранения сессий
- Обработки токенов
- Интеграции с Supabase для аутентификации

Это сложное решение, которое не рекомендуется, так как Supabase уже предоставляет безопасную и надежную систему аутентификации.

## Рекомендация

**Для бесплатного плана:** Используйте Вариант 2. Хотя Google будет показывать домен Supabase в интерфейсе выбора аккаунта, пользователи все равно будут редиректиться на ваш реальный сайт после авторизации. Это стандартное поведение для всех приложений, использующих Supabase на бесплатном плане.

**Для профессионального решения:** Если важно, чтобы Google показывал ваш домен, рассмотрите возможность перехода на платный план Supabase с кастомным доменом (Вариант 1).

## Дополнительные настройки

### Улучшение пользовательского опыта

Хотя вы не можете изменить то, что Google показывает в интерфейсе выбора аккаунта, вы можете:

1. **Добавить информационное сообщение** перед авторизацией:
   - Объясните пользователям, что они будут перенаправлены через Supabase для безопасной авторизации
   - Убедите их, что это безопасно и стандартная практика

2. **Использовать правильный redirectTo:**
   - Убедитесь, что `redirectTo` указывает на ваш реальный домен
   - Это гарантирует, что после авторизации пользователь вернется на ваш сайт

3. **Настроить правильные URL в Supabase:**
   - Убедитесь, что Site URL и Redirect URLs правильно настроены
   - Это важно для безопасности и правильной работы редиректов

## Проверка настройки

После настройки проверьте:

1. ✅ Авторизация через Google работает
2. ✅ После авторизации пользователь редиректится на ваш реальный домен (не на Supabase)
3. ✅ Сессия сохраняется правильно
4. ✅ Пользователь может использовать приложение

## Заключение

К сожалению, на бесплатном плане Supabase невозможно полностью скрыть домен Supabase в интерфейсе Google OAuth. Это ограничение самого Google OAuth и архитектуры Supabase. Однако, правильная настройка гарантирует, что пользователи будут редиректиться на ваш реальный сайт после авторизации, что является наиболее важным аспектом пользовательского опыта.
